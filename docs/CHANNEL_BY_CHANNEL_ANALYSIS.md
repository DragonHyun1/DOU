# 채널별 상세 비교 분석

**날짜:** 2025-11-10  
**상태:** Manual 측정값 확보, 채널별 차이 분석

---

## 📊 채널별 상세 비교

### 측정값 비교 (단위: mA)

| 채널 | DoU | Manual | 비율 | Shunt | 비고 |
|------|-----|--------|------|-------|------|
| ai0 | -0.337 | 0.08 | 4.2배 | 0.01Ω | 부호 반대! |
| ai1 | 0.789 | 0.4 | 2.0배 | 0.1Ω | |
| ai2 | -1.786 | -0.77 | 2.3배 | 0.005Ω | 부호 동일 |
| ai3 | 6.533 | 1.018 | 6.4배 | 0.005Ω | 가장 큰 차이 |
| ai4 | 0.337 | 0.14 | 2.4배 | 0.1Ω | |
| ai5 | 2.984 | 0.044 | 67.8배 | 0.01Ω | 비정상적! |

### 총합 계산

**Manual (절대값):**
```
0.08 + 0.4 + 0.77 + 1.018 + 0.14 + 0.044 = 2.452mA ≈ 2.5mA ✓
```

**DoU (절대값):**
```
0.337 + 0.789 + 1.786 + 6.533 + 0.337 + 2.984 = 12.766mA ≈ 14.4mA ✓
```

**전체 비율:**
```
12.766 / 2.452 = 5.2배
```

---

## 🚨 핵심 발견

### 1. 채널별로 비율이 다름!

```
ai0: 4.2배
ai1: 2.0배
ai2: 2.3배
ai3: 6.4배
ai4: 2.4배
ai5: 67.8배 ← 비정상!
```

**의미:** 전역 Gain/Range 문제가 아닙니다!  
→ **채널별 설정 또는 연결 문제**

### 2. ai5가 비정상적으로 큼

```
ai5: DoU 2.984mA vs Manual 0.044mA = 67.8배!

다른 채널들: 2~6배
ai5만: 67배

→ ai5에 심각한 문제!
```

### 3. ai3의 shunt 저항 문제 의심

```
ai3 shunt: 0.005Ω (5mΩ)

DoU 전압: 0.033mV → 전류: 0.033/0.005 = 6.6mA ✓
Manual 전류: 1.018mA

만약 실제 shunt가 0.005Ω가 아니라면?
역산: 0.033mV / 1.018mA = 0.0324Ω
→ 실제는 0.032Ω? (6.4배!)
```

---

## 🔍 원인 분석

### 원인 1: Shunt 저항 값이 실제와 다름 ⭐⭐⭐

**DoU 설정과 실제 하드웨어 불일치:**

```
채널  DoU 설정   실제 값(추정)   비율
ai0   0.01Ω     0.042Ω?        4.2배
ai1   0.1Ω      0.2Ω?          2배
ai2   0.005Ω    0.012Ω?        2.3배
ai3   0.005Ω    0.032Ω?        6.4배
ai4   0.1Ω      0.24Ω?         2.4배
ai5   0.01Ω     0.678Ω?        67.8배!
```

**검증 방법:**
하드웨어 보드에서 실제 shunt 저항 값 확인!

### 원인 2: DoU와 Manual이 다른 측정 포인트

**DoU:**
```
Shunt 양단 전압 차이 측정?
또는 특정 포인트만?
```

**Manual:**
```
정확한 Shunt 양단 차이 측정?
```

**만약 측정 위치가 다르면:**
같은 shunt라도 다른 전압 측정

### 원인 3: ai5 연결 오류

**ai5만 유독 큰 차이 (67배):**
```
가능한 원인:
1. ai5의 shunt가 실제로 0.678Ω (표시는 0.01Ω)
2. ai5가 잘못된 포인트에 연결
3. ai5의 증폭기/스케일링 문제
```

---

## 🧮 Shunt 저항 역산

### 각 채널의 실제 shunt 값 추정

**DoU 측정 전압을 Manual 전류로 나누면:**

```python
실제_shunt = DoU_전압 / Manual_전류

ai0: 0.003mV / 0.08mA = 0.0375Ω (설정: 0.01Ω, 3.75배)
ai1: 0.079mV / 0.4mA = 0.1975Ω (설정: 0.1Ω, 1.975배)
ai2: 0.009mV / 0.77mA = 0.0117Ω (설정: 0.005Ω, 2.34배)
ai3: 0.033mV / 1.018mA = 0.0324Ω (설정: 0.005Ω, 6.48배!)
ai4: 0.034mV / 0.14mA = 0.243Ω (설정: 0.1Ω, 2.43배)
ai5: 0.030mV / 0.044mA = 0.682Ω (설정: 0.01Ω, 68.2배!)
```

**패턴:**
- ai1, ai2, ai4: 약 2배 차이 (±20%)
- ai0: 3.75배
- ai3: 6.48배
- ai5: 68.2배 (비정상!)

---

## 💡 가능한 시나리오

### 시나리오 A: Shunt 값 표기 오류

**실제 하드웨어:**
```
ai0: 0.04Ω (표시/설정: 0.01Ω)
ai1: 0.2Ω (표시/설정: 0.1Ω)
ai2: 0.01Ω (표시/설정: 0.005Ω)
ai3: 0.03Ω (표시/설정: 0.005Ω)
ai4: 0.24Ω (표시/설정: 0.1Ω)
ai5: 0.68Ω (표시/설정: 0.01Ω)
```

### 시나리오 B: 채널 그룹별 차이

**그룹 1 (ai1, ai2, ai4): 약 2배**
```
공통점: 비슷한 비율
가능성: 동일한 증폭기/설정
```

**그룹 2 (ai3): 6.4배**
```
ai3만 다른 설정?
```

**그룹 3 (ai5): 68배**
```
ai5는 완전히 다른 문제
```

### 시나리오 C: Manual이 정확하고 DoU가 잘못됨

**Manual 측정이 정확하다면:**
```
DoU의 전압 측정이 잘못됨
→ Gain/Range 설정 확인 필요
```

---

## 🔧 해결 방법

### 방법 1: 실제 Shunt 값으로 수정 ⭐⭐⭐

**하드웨어 보드에서 실제 값 확인 후:**

```
DoU UI에서 수정:
ai0: 0.01Ω → 0.0375Ω
ai1: 0.1Ω → 0.2Ω
ai2: 0.005Ω → 0.012Ω
ai3: 0.005Ω → 0.032Ω
ai4: 0.1Ω → 0.24Ω
ai5: 0.01Ω → 0.68Ω
```

**예상 결과:**
```
ai3: 6.533mA → 1.006mA (Manual 1.018mA와 일치!)
총합: 14.4mA → 2.5mA (Manual과 일치!)
```

### 방법 2: ai5 연결 확인 ⭐⭐⭐

**ai5는 특별히 확인 필요:**
```
1. 올바른 shunt에 연결되었는지
2. 올바른 극성인지 (+/-)
3. shunt 값이 실제로 0.68Ω인지
```

### 방법 3: 채널별 Scale Factor 적용 (임시)

```python
SCALE_FACTORS = {
    'ai0': 1.0 / 3.75,
    'ai1': 1.0 / 2.0,
    'ai2': 1.0 / 2.34,
    'ai3': 1.0 / 6.48,
    'ai4': 1.0 / 2.43,
    'ai5': 1.0 / 68.2
}

current_corrected = current_measured * SCALE_FACTORS[channel]
```

---

## 📋 즉시 확인 필요 사항

### 우선순위 1: 하드웨어 Shunt 값 확인 ⭐⭐⭐

**보드에서 실제 값 확인:**
```
ai0 shunt: _____Ω (DoU 설정: 0.01Ω)
ai1 shunt: _____Ω (DoU 설정: 0.1Ω)
ai2 shunt: _____Ω (DoU 설정: 0.005Ω)
ai3 shunt: _____Ω (DoU 설정: 0.005Ω)
ai4 shunt: _____Ω (DoU 설정: 0.1Ω)
ai5 shunt: _____Ω (DoU 설정: 0.01Ω)
```

### 우선순위 2: ai5 연결 확인 ⭐⭐⭐

**ai5가 68배 차이나는 이유:**
```
1. 연결 위치 확인
2. 극성 확인
3. Shunt 저항 재측정
```

### 우선순위 3: Manual 전압 측정

**Manual에서도 전압 측정 가능하면:**
```
ai3 전압: _____mV (DoU: 0.033mV)
```

---

## 🎯 다음 단계

### 1단계: 하드웨어 Shunt 값 확인
```
보드에서 실제 저항 값 측정 또는 확인
```

### 2단계: DoU 설정 수정
```
실제 값으로 shunt 저항 업데이트
```

### 3단계: 재테스트
```
Phone App Test 다시 실행
Manual과 비교
```

### 4단계: 검증
```
각 채널이 Manual과 ±10% 이내로 일치하는지 확인
```

---

## 📝 요약

**발견:**
- 채널별로 2배~68배 다양한 차이
- 전역 Gain 문제가 아님
- Shunt 저항 값 설정 문제 가능성 높음

**가장 의심되는 원인:**
1. ⭐⭐⭐ DoU의 Shunt 설정값이 실제와 다름
2. ⭐⭐ ai5의 연결 또는 설정 오류
3. ⭐ 측정 포인트 차이

**즉시 필요:**
- 하드웨어 보드에서 실제 Shunt 값 확인
- 특히 ai3 (0.005Ω → 0.032Ω?) 
- 특히 ai5 (0.01Ω → 0.68Ω?)

**예상 해결:**
실제 Shunt 값으로 수정하면 Manual과 일치할 것!
