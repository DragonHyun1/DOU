# Calibration vs 근본 원인 분석

**현재 상황:** Calibration factor 적용하여 Manual과 일치  
**질문:** 이것이 정당한 해결책인가? 아니면 임시방편인가?

---

## 📊 근본 원인 가능성 분석

### 원인 1: 실제 Shunt 저항 값이 다름 ⭐⭐⭐ (가능성 80%)

**증거:**
```
ai3 예시:
- DoU 설정: 0.005Ω
- 측정 전압: 0.033mV
- 계산 전류: 6.533mA

- Manual 전류: 1.018mA (정확한 측정)
- 역산 shunt: 0.033mV / 1.018mA = 0.0324Ω

실제 shunt: 0.0324Ω (설정의 6.48배!)
```

**검증 방법:**
```
1. 멀티미터로 실제 shunt 저항 측정
2. 보드에 표시된 값 확인
3. Manual 툴의 shunt 설정 확인
```

**이 경우 해결책:**
```
Calibration이 아니라 Shunt 값 수정!

현재 코드:
current = voltage / 0.005Ω * 0.156  (보정)

올바른 코드:
current = voltage / 0.0324Ω  (정확한 shunt)
```

### 원인 2: DEFAULT Mode가 증폭/스케일링 적용 ⭐⭐ (가능성 15%)

**가능성:**
```
DEFAULT mode에서:
- 하드웨어 jumper 설정 따름
- 하지만 jumper가 증폭 모드로 설정?
- 또는 pre-amplifier 통과?

결과:
- 실제 0.005mV인데 0.033mV로 증폭되어 측정
```

**검증 방법:**
```
1. DAQ 하드웨어 jumper 설정 확인
2. Manual이 사용하는 mode 확인
3. 다른 terminal mode 시도
```

**이 경우 해결책:**
```
Calibration보다는 올바른 mode 사용!
```

### 원인 3: 측정 포인트가 다름 ⭐ (가능성 5%)

**가능성:**
```
DoU: Shunt + 케이블 + 커넥터 전체 전압 강하
Manual: 순수 Shunt만 측정

결과:
- DoU가 더 큰 값 측정
```

**이 경우 해결책:**
```
Calibration이 정당함!
(측정 경로 특성 보정)
```

---

## 🔬 채널별 보정 팩터 패턴 분석

### 데이터

| 채널 | 설정 Shunt | 보정 팩터 | 추정 실제 Shunt | 비율 |
|------|-----------|-----------|----------------|------|
| ai1 | 0.1Ω | 0.507 | 0.197Ω | 1.97배 |
| ai2 | 0.005Ω | 0.431 | 0.012Ω | 2.32배 |
| ai4 | 0.1Ω | 0.415 | 0.241Ω | 2.41배 |
| ai0 | 0.01Ω | 0.237 | 0.042Ω | 4.22배 |
| ai3 | 0.005Ω | 0.156 | 0.032Ω | 6.48배 |
| ai5 | 0.01Ω | 0.015 | 0.682Ω | 68.2배 |

### 패턴 발견

**그룹 A (ai1, ai2, ai4): 약 2~2.5배**
```
비교적 일관성 있음
→ 공통 원인 있을 가능성
```

**그룹 B (ai0): 약 4배**
```
그룹 A의 2배
→ 다른 회로 경로?
```

**그룹 C (ai3): 약 6.5배**
```
그룹 A의 3배
→ 특수한 설정?
```

**그룹 D (ai5): 약 68배**
```
완전히 비정상
→ 연결 오류 또는 잘못된 shunt
```

### 분석 결론

**일관성 없는 패턴 = Calibration 적절하지 않음!**

만약 모든 채널이 같은 비율이었다면:
```
예: 모두 2배
→ 전역 gain 문제
→ Calibration 정당함
```

하지만 현재:
```
2배 ~ 68배로 다양
→ 채널별로 다른 문제
→ Shunt 값 자체가 틀렸을 가능성 높음
```

---

## 🎯 권장 조치

### 단기 (현재 상황)

**✅ Calibration 사용해도 됨**

**이유:**
```
1. 측정값이 Manual과 일치
2. 즉시 사용 가능
3. 기능적으로 작동함
```

**주의사항:**
```
1. 환경 변화 시 재보정 필요
2. 다른 테스트 시나리오에서도 검증 필요
3. 주기적으로 Manual과 비교
```

### 중기 (1주일 내)

**❗ 근본 원인 파악 필요**

**조사 항목:**

1. **실제 Shunt 저항 측정 ⭐⭐⭐**
```bash
멀티미터로 각 채널의 shunt 측정
보드 표시 확인
Manual 툴 설정 확인
```

2. **ai5 특별 조사 ⭐⭐⭐**
```
68배 차이는 비정상
연결 오류일 가능성 높음
```

3. **Manual 측정 방식 확인 ⭐⭐**
```
Manual이 어떻게 측정하는지
설정 확인
문서 확인
```

### 장기 (근본 해결)

**두 가지 시나리오:**

**시나리오 A: Shunt 값이 틀렸다면**
```python
# Calibration 제거
# Shunt 값 수정

# 수정 전
SHUNT_RESISTORS = {
    'ai3': 0.005Ω  # 틀림!
}

# 수정 후  
SHUNT_RESISTORS = {
    'ai3': 0.032Ω  # 실제 값
}

# Calibration 불필요!
current = voltage / actual_shunt
```

**시나리오 B: 측정 경로 특성이라면**
```python
# Calibration 유지하되 체계화

# 각 채널의 "측정 시스템 gain"으로 이해
MEASUREMENT_SYSTEM_GAINS = {
    'ai0': 4.22,  # 명확한 이름
    'ai1': 1.97,
    # ...
}

# 정기적 재보정 프로세스 수립
```

---

## 📋 판단 기준

### Calibration이 정당한 경우

**✅ 사용해도 됨:**
```
1. 모든 채널 비슷한 비율 (예: 모두 2배)
   → 전역 gain 문제

2. 측정 경로의 물리적 특성
   → 케이블, 커넥터 임피던스

3. DAQ 개체별 편차
   → Factory calibration

4. 온도/환경 영향
   → Systematic error
```

### Calibration이 부적절한 경우

**❌ 근본 원인 찾아야 함:**
```
1. 채널별로 비율이 크게 다름 (현재 상황!)
   → 설정 오류 가능성

2. 특정 채널만 비정상 (ai5: 68배)
   → 연결 오류

3. 시간에 따라 변함
   → 하드웨어 문제

4. 측정 범위에 따라 변함
   → 비선형성 문제
```

---

## 🎯 현재 상황 판단

### 현재 Calibration 상태

**임시방편에 가까움 (70%)**

**이유:**
```
1. 채널별 비율이 2배~68배로 다양
   → 일관성 없음
   → 설정 오류 의심

2. ai5가 68배 차이
   → 명백한 문제
   → Calibration으로 해결할 문제 아님

3. 실제 shunt 값 미확인
   → 가장 의심되는 원인
   → 확인 후 수정해야 함
```

**하지만 실용적 (30%)**

**이유:**
```
1. 측정 결과가 Manual과 일치
   → 기능적으로 작동

2. 즉시 사용 가능
   → 프로젝트 진행 가능

3. 추후 개선 가능
   → 나중에 근본 원인 찾아도 됨
```

---

## ✅ 결론 및 권장사항

### 즉시 행동

**✅ 현재 Calibration 사용**
```
- Manual과 일치하므로 사용 가능
- Phone App Test 진행 가능
- 결과 신뢰 가능
```

### 1주일 내

**❗ 근본 원인 조사**
```
우선순위 1: ai5 연결 확인 (68배 비정상)
우선순위 2: 실제 shunt 값 측정
우선순위 3: Manual 설정 확인
```

### 근본 해결

**만약 shunt 값이 틀렸다면:**
```
→ Calibration 제거하고 shunt 값 수정
```

**만약 측정 경로 특성이라면:**
```
→ Calibration 체계화하고 유지
```

---

## 📊 요약

**질문: Calibration이 임시방편인가?**

**답변: 70% 임시방편, 30% 정당함**

**근거:**
- 채널별 비율이 일관성 없음 (임시방편)
- 하지만 기능적으로 작동함 (실용적)
- 실제 shunt 값 확인 후 판단 필요

**권장:**
1. ✅ 지금 당장은 사용해도 됨
2. ❗ 실제 shunt 값 확인 필요
3. 🔧 근본 원인 찾아서 수정 필요
